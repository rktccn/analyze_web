<template>
  <div>
  <span class='title'>
    聚类分析
  </span>
    <el-button type='primary' @click="getData">导入数据</el-button>
    <load-data :columns="originColumns" :data="originData"></load-data>
    <div>
      <el-row :gutter='20'>
        <el-col :span='12'>
          <!--散点图展示-->
          <div class='main block'>
            <v-chart class='chart' :option='scatterOption' autoresize/>
          </div>
        </el-col>
        <el-col :span='12'>
          <!--聚类图展示-->
          <div class='main block' style='text-align: center'>
            <v-chart class='chart' :option='clusterOption' autoresize/>
            <span>K值设定： <el-input-number v-model='k_value' :min='1' :max='10'/></span>
          </div>
        </el-col>
      </el-row>
    </div>
  </div>
</template>

<script setup>
import LoadData from '@/components/loadData.vue'
import VChart from 'vue-echarts'

import {CanvasRenderer} from 'echarts/renderers'
import {ScatterChart} from 'echarts/charts'
import {
  TitleComponent,
  TooltipComponent,
  VisualMapComponent
} from 'echarts/components'
import {use} from 'echarts/core'
import {ref} from 'vue'

use([
  CanvasRenderer,
  TitleComponent,
  TooltipComponent,
  VisualMapComponent,
  ScatterChart
])

// 原始数据
const originData = ref([])
const originColumns = ref([])

const scatterOption = ref({
  title: {
    text: '散点图',
    left: 'center'
  },
  xAxis: {},
  yAxis: {},
  series: [
    {
      symbolSize: 20,
      data: [
        [10.0, 8.04],
        [8.07, 6.95],
        [13.0, 7.58],
        [9.05, 8.81],
        [11.0, 8.33],
        [14.0, 7.66],
        [13.4, 6.81],
        [10.0, 6.33],
        [14.0, 8.96],
        [12.5, 6.82],
        [9.15, 7.2],
        [11.5, 7.2],
        [3.03, 4.23],
        [12.2, 7.83],
        [2.02, 4.47],
        [1.05, 3.33],
        [4.05, 4.96],
        [6.03, 7.24],
        [12.0, 6.26],
        [12.0, 8.84],
        [7.08, 5.82],
        [5.02, 5.68]
      ],
      type: 'scatter'
    }
  ]
})

// 聚类图
// K值
const k_value = ref(3)
// 生成十二种不同颜色
const color = [
  '#5470c6',
  '#91cc75',
  '#fac858',
  '#ee6666',
  '#73c0de',
  '#3ba272',
  '#fc8452',
  '#9a60b4',
  '#ea7ccc',
  '#4169E1',
  '#FF1493'
]

const clusterOption = ref({
  title: {
    text: '散点图',
    left: 'center'
  },
  color: color,
  xAxis: {},
  yAxis: {},
  series: [
    {
      symbolSize: 20,
      data: [
        [1.28482569, 0.68516047],
        [1.46430232, 0.50426282],
        [1.55780216, 0.26749545],
        [2.53119273, -0.00984911],
        [2.61667602, 0.34390315],
        [1.97153105, -0.1797279],
        [2.35000592, -0.04026095],
        [3.39703874, 0.55083667],
        [2.93258707, 0.3555],
        [2.32122882, -0.2438315],
        [2.91675097, 0.78279195],
        [1.66177415, 0.24222841],
        [1.80340195, -0.21563762],
        [2.1655918, 0.21627559],
        [1.90445637, 0.11925069],
        [1.94968906, 0.04194326],
        [3.48705536, 1.17573933],
        [3.79564542, 0.25732297],
        [2.42781791, 0.37819601],
        [3.49992004, 0.4606741],
        [2.2754305, 0.33499061],
        [2.61409047, 0.56090136],
        [2.12360872, -0.20972948],
        [2.38800302, 0.4646398],
        [2.84167278, 0.37526917],
        [3.23067366, 1.37416509],
        [2.15943764, -0.21727758],
        [1.78129481, -0.49990168],
        [3.07649993, 0.68808568],
        [2.14424331, 0.1400642],
        [1.90509815, 0.04930053],
        [2.10761114, 0.37228787],
        [2.31415471, 0.18365128],
        [1.9222678, 0.40920347],
        [2.56301338, 0.2778626],
        [2.41874618, 0.3047982],
        [1.94410979, 0.1875323],
        [1.76434572, 0.07885885],
        [1.90094161, 0.11662796],
      ],
      type: 'scatter'
    }, {
      symbolSize: 20,
      data: [
        [-2.6841256259695374, 0.3193972465851019],
        [-2.7141416872943265, -0.17700122506478058],
        [-2.888990569059297, -0.1449494260855574],
        [-2.74534285564141, -0.318298979251916],
        [-2.7287165365545305, 0.32675451293491986],
        [-2.2808596328444923, 0.7413304490629148],
        [-2.820537750740609, -0.08946138452856865],
        [-2.626144973146633, 0.16338495969832856],
        [-2.8863827317805537, -0.5783117541867039],
        [-2.672755797820954, -0.11377424587411698],
        [-2.506947090651856, 0.6450688986485738],
        [-2.6127552309087236, 0.014729939161374515],
        [-2.786109266188018, -0.23511200020171852],
        [-3.2238037438656533, -0.5113945870063822],
        [-2.644750389942029, 1.1787646364375748],
        [-2.3860390335311337, 1.3380623304006525],
        [-2.6235278752244264, 0.8106795141812576],
        [-2.6482967062543814, 0.3118491445933546],
        [-2.1998203236175797, 0.8728390389622105],
        [-2.5879863998787687, 0.5135603087492768],
        [-2.3102562152425183, 0.3913459356538939],
        [-2.5437052287571564, 0.4329960632790281],
        [-3.215939415648612, 0.13346806953852594],
        [-2.302733182226207, 0.09870885481409937],
        [-2.3557540491237727, -0.037281859677382526],
        [-2.5066689069258223, -0.14601688049526787],
        [-2.468820073121339, 0.13095148943525023],
        [-2.562319906196016, 0.36771885743419974],
        [-2.639534715384543, 0.3120399802352826],
        [-2.6319893872743467, -0.19696122492431453],
        [-2.5873984766893527, -0.20431849127413348],
        [-2.409932497002175, 0.4109242642295726],
        [-2.6488623343499125, 0.813363820296962],
        [-2.598736749100587, 1.0931457594493568],
        [-2.6369268781057995, -0.12132234786586331],
        [-2.8662416521186698, 0.06936447158008038],
        [-2.6252380498503722, 0.5993700213794233],
        [-2.8006841154482225, 0.2686437377979823],
        [-2.980502043781994, -0.48795834442861535],
        [-2.590006313968096, 0.22904383682701246],
        [-2.770102426027902, 0.26352753374425647],
        [-2.8493687050431045, -0.9409605736411967],
        [-2.9974065465949082, -0.3419260574716098],
        [-2.405614485097486, 0.18887142893026038],
        [-2.2094892377836794, 0.43666314163918785],
        [-2.714451426757708, -0.25020820418521117],
        [-2.53814825899894, 0.5037711444614376],
        [-2.8394621676428504, -0.22794556949382755],
        [-2.543085749830393, 0.5794100215198891],
        [-2.70335978233516, 0.10770608249941152],
      ],
      type: 'scatter'
    }, {
      symbolSize: 20,
      data: [
        [0.9324885323123177, 0.31833363826262856],
        [0.18331771995836976, -0.8279590118206324],
        [1.0881032577116656, 0.07459067519771567],
        [0.641669084258077, -0.41824687156867885],
        [1.0950606626324462, 0.28346827006152875],
        [-0.7491226698296582, -1.0048909611818952],
        [1.044131826053435, 0.22836189978839502],
        [-0.008745404082897042, -0.723081905004834],
        [-0.5078408838353267, -1.2659711905263937],
        [0.5116985574475968, -0.10398123549904058],
        [0.2649765081120461, -0.5500364636804753],
        [0.9849345104708895, -0.12481785412635768],
        [-0.17392537168176844, -0.2548542087025894],
        [0.927860780944247, 0.46717949444151],
        [0.6602837616969361, -0.3529696657238504],
        [0.23610499331767099, -0.3336107668249157],
        [0.9447337280198124, -0.543145550779767],
        [0.045226976298699206, -0.5838343774718646],
        [1.1162831773500488, -0.08461685219478804],
        [0.35788841799730686, -0.06892503165601431],
        [1.2981838753589126, -0.3277873083339178],
        [0.9217289224470363, -0.1827377936213678],
        [0.7148533259114113, 0.14905594436978425],
        [0.900174373172167, 0.3285044738343227],
        [1.3320244367220881, 0.2444408760163428],
        [0.8132906498175407, -0.16335030068761647],
        [-0.3055837780243095, -0.36826218975458824],
        [-0.06812649206836435, -0.7051721317994655],
        [-0.18962247237850266, -0.6802867635281334],
        [0.13642871155801437, -0.314032438249237],
        [1.38002643591551, -0.42095428731388196],
        [0.5880064433398624, -0.48428741998121816],
        [0.8068583125004113, 0.19418231471315078],
        [1.2206908824443523, 0.4076195936110067],
        [0.8150952357665988, -0.3720370599095023],
        [0.2459576798866916, -0.268524396622015],
        [0.16641321714545612, -0.6819267248636268],
        [0.46480028840377846, -0.6707115445117204],
        [0.8908151984694487, -0.03446444436826912],
        [0.23054802355945478, -0.4043858480073254],
        [-0.7045317592446643, -1.0122482275317142],
        [0.3569814947010463, -0.5049100933371088],
        [0.3319344799450577, -0.21265468378116997],
        [0.3762156510666697, -0.2932189292514191],
        [0.6425760075543374, 0.017738190112415897],
        [-0.9064698649488365, -0.7560933665990142],
        [0.29900084187814263, -0.3488978064503361],
        [1.4152358767039013, -0.5749163475464893],
        [0.5212322439097721, -1.1927587270006448],
        [1.3461635794584506, -0.7768183473443396],
        [1.5859282238732197, -0.5396407140267186],
        [1.300791712637656, -0.7611496364350638],
        [1.1990011054655598, -0.6060915277579304],
        [1.3887661316914643, -0.20439932735215122],
        [1.258508160511487, -0.1797047947227469],
        [1.2911320591150202, -0.11666865117401161],
        [1.4441612423295087, -0.1434134104575811],
        [1.1693263393414992, -0.1649902620231097],
        [1.4152358767039013, -0.5749163475464893],
        [1.5271666148145162, -0.37531698258048873],
        [1.3901888619479126, -0.2826609379905506],
      ],
      type: 'scatter'
    }
  ]
})

const getData = () => {
  const generateColumns = (length = 10, prefix = 'column-', props) =>
      Array.from({length}).map((_, columnIndex) => ({
        ...props,
        key: `${prefix}${columnIndex}`,
        dataKey: `${prefix}${columnIndex}`,
        title: `Column ${columnIndex}`,
        width: 150
      }))

  const generateData = (
      columns,
      length = 200,
      prefix = 'row-'
  ) =>
      Array.from({length}).map((_, rowIndex) => {
        return columns.reduce(
            (rowData, column, columnIndex) => {
              rowData[column.dataKey] = `Row ${rowIndex} - Col ${columnIndex}`
              return rowData
            }, {
              id: `${prefix}${rowIndex}`
              // parentId: null
            }
        )
      })

  originColumns.value = generateColumns(10)
  originData.value = generateData(originColumns.value, 1000)
}
</script>

<style lang='scss' scoped>

</style>
